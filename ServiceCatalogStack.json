{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "SageMaker Service Catalog Setup",
    "Parameters": {
		"ProjectName": {
			"Description": "SageMaker Project name",
			"Type": "String"
		},
		"SourceBucket": {
		  "Description": "S3 Bucket Name where All cloudformation templates are stored.",
		  "Type": "String"
		},
		"AdminGroupName": {
		  "Description": "Admin group Name.",
		  "Type": "String"
		},
		"UserGroupName": {
		  "Description": "User group name who will access Service Catalog",
		  "Type": "String"
		}
    },
    "Resources": {
		"SageMakerPortfolio": {
		    "Type" : "AWS::ServiceCatalog::Portfolio",
		    "Properties" : {
			    "AcceptLanguage" : "en",
			    "Description" : "Sagemaker Portfolio with all Guardrails",
			    "DisplayName" : {
					"Fn::Join": [
                        "",
                        [{
                                "Ref": "ProjectName"
                            },
                            "_SageMakerPortfolio"
                        ]
                    ]
                },
			    "ProviderName" : "Brillio",
			    "Tags" : [
				   {
					   "Key" : "Name",
					   "Value" : {
							"Fn::Join": [
								"",
								[{
										"Ref": "ProjectName"
									},
									"_SageMakerPortfolio"
								]
							]
					    }
				    },
				    {
						"Key": "ProjectName",
						"Value": { "Ref" : "ProjectName" }
				    }
				]
			}
		},
		"SageMakerProduct": {
		    "Type" : "AWS::ServiceCatalog::CloudFormationProduct",
		    "Properties" : {
				"AcceptLanguage" : "en",
				"Description" : "This product creates SageMaker Product with provided parameter values.",
				"Distributor" : "Amazon",
				"Name" : {
					"Fn::Join": [
                        "",
                        [{
                                "Ref": "ProjectName"
                            },
                            "_SageMakerProduct"
                        ]
                    ]
				},
				"Owner" : "Brillio",
				"ProvisioningArtifactParameters" : [
					{
						"Description" : "This product creates SageMaker Product with provided parameter values.",
						"Info" : {
                            "LoadTemplateFromURL": {
                                "Fn::Join": ["", ["https://s3.amazonaws.com/", { "Ref" : "SourceBucket" }, "/SagemakerProduct.json"]]
                            }
						},
						"Name" : "Version 1"
					}
				],
				"SupportDescription" : "Brillio DI Team",
				"SupportEmail" : "aws-brillio@brillio.com",
				"SupportUrl": "https://www.brillio.com/what-we-do/digital-infrastructure/cloud-infrastructure/",
				"Tags" : [
					{
						"Key" : "Name",
						"Value" : {
							"Fn::Join": [
								"",
								[{
										"Ref": "ProjectName"
									},
									"_SageMakerProduct"
								]
							]
						}
					},
					{
						"Key": "ProjectName",
						"Value": { "Ref" : "ProjectName" }
					}
				]
			}
		},
		"SageMakerProductAssociation" : {
			"Type" : "AWS::ServiceCatalog::PortfolioProductAssociation",
			"Properties" : {
				"PortfolioId" : { "Ref" : "SageMakerPortfolio" },
				"ProductId" : { "Ref" : "SageMakerProduct" }
			}
		},
		"PortfolioAdminAssociation" : {
			"Type" : "AWS::ServiceCatalog::PortfolioPrincipalAssociation",
			"Properties" : {
				"PortfolioId" : { "Ref" : "SageMakerPortfolio" },
				"PrincipalARN" : {
                    "Fn::Join": ["", ["arn:aws:iam::", { "Ref" : "AWS::AccountId" }, ":group/", { "Ref" : "AdminGroupName" }]]
				},
				"PrincipalType" : "IAM"
			}
		},
		"PortfolioGroupAssociation" : {
			"Type" : "AWS::ServiceCatalog::PortfolioPrincipalAssociation",
			"Properties" : {
				"PortfolioId" : { "Ref" : "SageMakerPortfolio" },
				"PrincipalARN" : {
                    "Fn::Join": ["", ["arn:aws:iam::", { "Ref" : "AWS::AccountId" }, ":group/", { "Ref" : "UserGroupName" }]]
				},
				"PrincipalType" : "IAM"
			}
		}
    },
    "Outputs": {
		"SageMakerPortfolio": {
            "Value": {
                "Ref": "SageMakerPortfolio"
            },
            "Description": "SageMaker Portfolio"
        },
		"SageMakerProduct": {
            "Value": {
                "Ref": "SageMakerProduct"
            },
            "Description": "SageMaker Product"
        }
    }
}