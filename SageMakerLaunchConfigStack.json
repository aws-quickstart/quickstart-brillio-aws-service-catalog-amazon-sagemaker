{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "NotebookInstance LifecycleConfig",
  "Parameters": {
	"ProjectName": {
        "Description": "SageMaker Project name",
        "Type": "String"
    },
    "EFSMountIpAddr": {
      "Description": "EFS mount target Ip address",
      "Type": "String"
    }
  },
  "Resources": {
    "EFSLifecycleConfig": {
      "Type": "AWS::SageMaker::NotebookInstanceLifecycleConfig",
      "Properties": {
	    "NotebookInstanceLifecycleConfigName" : {
			"Fn::Join": ["", 
                        [{"Ref": "ProjectName"},
						 "-EFS-LC"
			]]
		},
        "OnCreate": [{
          "Content": {
            "Fn::Base64": {
              "Fn::Join": ["", [
                "#!/bin/bash \n",
				
				"sudo -u ec2-user -i \n",

				"# Creating the directory for EFS \n",
				"sudo mkdir /home/ec2-user/SageMaker/efs \n",
				

                "#Mount The EFS to that directory\n",
                {
                  "Fn::Sub": "sudo mount -t nfs -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2 ${EFSMountIpAddr}:/ /home/ec2-user/SageMaker/efs \n"
                },
				"# Permission chnage \n",
				"sudo chown ec2-user:ec2-user /home/ec2-user/SageMaker/efs --recursive"
              ]]
            }
          }
        }]
      }
    }
  },
  "Outputs": {
    "NbInstanceLifecycleConfigId": {
      "Value": {
        "Ref": "EFSLifecycleConfig"
      }
    }
  }
}